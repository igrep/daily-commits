# 2024/10/28 - 2024/11/03

- custard:
    - [ ] とりあえず <https://github.com/kanaka/mal> を参考にStep 8までTypeScriptでやる
        - [ ] Step 8: Macros <https://github.com/kanaka/mal/blob/master/process/guide.md#step-8-macros>
            - 2024/10/28: また課題が見つかった。transpile時にマクロを展開してマクロの外の値を更新した場合、現状更新した結果を外の変数に反映させようがない。でも反映させないとreplでの挙動と一貫しなくなるし、なんとかやるか...
                - あるいは更新を禁止するか、だなあ。
                    - そうすると「定義を自動でまとめる問題」に対応しづらくなるかと思ったけど、モジュールが定義した変数とかを列挙できれば多分なんとかなるか
                    - あと、ミュータブルな参照の場合そもそも更新を禁止する自体が難しそうだ
                - マクロで起きた更新はマクロの外からは見えないって方が一貫させやすそうだね。今度はrepl側での実装が難しそうだけど
                    - 必要な値だけ適宜コピーできればそれで解決しそうだけど、暗黙に更新されるケースもあるし、やっぱ難しいか
                - マクロ自体が特殊な機能だし、現状のままで多少がしょうがない気もする
            - 2024/10/29: `repl`の場合なんで落ちるんだろうと思ったらそりゃそうか、`module`と同じで、マクロの実行前にそれまで`transpile`した部分を評価していないからうまくいくわけがない
            - 2024/10/30: 昨日発覚したバグを直すための設計変更着手
            - 2024/10/31: `repl`の場合のバグ修正引き続き。`initializeRepl`の引数が増えたから影響範囲が大きい
            - 2024/11/01: `repl`の場合のバグ修正引き続き。`initializeRepl`の増えた引数に関する修正が終わり。後は実際にマクロの実行前に`inputBlock`を評価するようにするだけ
- 読書など:
    - [効率的なGo](https://www.oreilly.co.jp//books/9784814400539/)
        - 2024/08/26 - 2024/11/01

[先週の記録はこちら](https://github.com/igrep/daily-commits/blob/c670a5f200a2c04a22efe51b99b499bbd7c87fb5/yesterday.md)
