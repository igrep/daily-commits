# 2026/01/05 - 2026/01/11

- custard:
    - [ ] sum-moneyの改善
        - 設計:
            - 日付にマッチする行を返す
                - => コメントがマッチする行だけを返す（grepでよさそう）
                    - => 合計のみを出す
                    - => 内訳を出す
        - 2026/01/05: テストを修正。今度はアプリケーション側のミスで`TranspileError`に
        - 2026/01/06: 今日はちょっとだけ。いよいよマクロをどうソースコードとして出すか、という問題に真剣に取り組まねば。テストケースをを追加しないとね
            - テスト中に複数のファイルをtranspileして使うという、今までやってなかったことをやらないといけないね
        - 2026/01/07: テストの追加をAIに任せてみたが、既存のテストケースとパターンが違いすぎるのか、うまくいかず。まあ実装を考えるヒントくらいにはなったかな...。
            - 現状の`testForm`だとかなりやりづらいかな...と、思ったけど、`setUpConfig`の中でマクロをtranspileすれば普通にいけるんじゃないか？
        - 2026/01/08: 昨日決めた方針でテストケースが多分出来た
        - 2026/01/09: テストの修正完了。実装も概ねできたと思う
        - 2026/01/10: 実装できていたかと思いきや、まだ問題が。書き出したマクロを`markAsMacro`する必要があるのだが、transpileしたソースの中でどうそれを呼ぶか。現状の方法だとtranspileしたコードにランタイムライブラリーとして`markAsMacro`を含めざるを得ない。それを許容するか。まあ今でも`standardModuleRoot`が事実上必ず含まれるし、別によさそう。`markAsMacro`が`meta`モジュールの一部として提供されることになるのがちょっと気持ち悪いが...。
        - 2026/01/11: 昨日見つけた問題は解決したものの、まだテストは落ちる
            - `markAsMacro`に渡す関数は、現状第1引数に`Context`を受け取ることを前提としているかららしい。現状使う術がないし、受け取らないようにした方がいいかも。あるいは、ちょっとダサいが`markAsMacroWithContext`みたいな別のformを用意するか。まあ、真面目にやるんならContextを受け取るクロージャーを作ってその文脈でマクロの関数を定義するだけどちょっと面倒だねぇ。と思ったけど、それなら`this`を使うって手もあるのか。いや、クロージャーや`this`だとあれか、取り回しが面倒いね。やっぱりグローバル変数を使うとかしないとダメなんだろうな。グローバルにしちゃって本当に大丈夫かは考えないと
                - 色々考えて分かった。`Context`を使っている（決まったモジュールを直接あるいは間接に`import`している）関数の場合は呼び出し時に第1引数として`Context`を渡すようにすればいいんだ。将来作る予定のモジュールシステムの仕様とも整合する
- 読書など:
    - [アンダースタンディング コンピュテーション](https://www.oreilly.co.jp/books/9784873116976/)
        - 2025/11/01 - 2026/01/11

[先週の記録はこちら](https://github.com/igrep/daily-commits/blob/c7bd26271a192acbe2f17ca1751e7cde9d1753cd/yesterday.md)
