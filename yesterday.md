# 2025/09/15 - 2025/09/21

- custard:
    - [ ] Conjureのサポート
        - 2025/09/15: 昨日問題を直したことでようやく`conjure/client/custard/stdio.fnl`を読んでくれるようになったらしいが、動いてないっぽい。実装してるはずの`eval-str`がないと言われる
            - なんと、改めてRacketのclientのソースを見てみたら、私がブックマークしていたのは`master`ブランチで、今は`main`ブランチが最新らしい。全然やり方が変わってる！よりLuaとの対応関係が分かりやすいものになったようだ
                - で、新しい形式に合わせて書き換えてみた。別のエラーに。何かLuaのコード生成の時点でバグっているとしか思えないコードだなぁ。とりあえず、直接書き換えた`compile.sh`も含めてコミットして聞いてみるか...
        - 2025/09/16: 尋ねるのに備えてcommit・pushしただけ。もう`require-macro`は使ってないし、コンパイル時の`runtimepath`はいじらなくていいっぽいね
        - 2025/09/17: よく見たら普通に凡ミスしていた。`(set M.hoge)`していたのに`M.hoge`ではなく`hoge`で参照していた。他にも色々ミスしていたので直してエラーをなくしたが、どうもファイルが読み込まれた時点でREPLが起動しないらしく、まだうまくいかない。やはり元ネタのRacketと比較するべきか。まあまだそこまでしなくてもできることはある
        - 2025/09/18: `.cstd`ファイルを読んだ時点では何も起きないが、`ConjureEval`を呼ぶとREPLを起動するコマンドを呼ぶようになった。が、`eval`した結果が表示されていないように見える。やっぱりRacketと比較した方が良さそう
            - あと、`watchexec`でFennelファイルを自動でトランスパイルするようにした。またwatchexecのlibcのバージョン違いで再インストールが必要になり手こずった
        - 2025/09/19: その前に、Conjureをしばらく更新してなかったので更新したら、巻き添えで諸々上がったので一部設定をそれに合わせて更新、あとRacketのインストール。やっぱりRacketではちゃんと動くけどCustardでは動いてないね
        - 2025/09/20: Conjureのコードリーディング。どうやらclientモジュールを作るだけじゃダメで、設定をデフォルト値から変えないといけなさそうなことまで分かって変えてみたけど、clientモジュールはまだ自動で読み込まれない。そして、clientモジュールを手で読み込んだとしてもREPLがちゃんと動いていないように見える。custardのREPLにログをファイルで書き込む必要があるね
            - それから、やっぱり行コメントをサポートした方が良さそう。どうしたものか...
        - 2025/09/21: `au conjure_init_filetypes`を実行してみたところ、やはりcustardの`autocmd`が登録されてない。昨日変えた設定が効いていないように見える。恐らく、設定が反映される前にConjureのモジュールの初期化が終わってしまっているんだろう
            - と、思って設定を更新した直後の行で`conjure.main`を実行してみたが、やはりダメだった。設定する項目が間違っているのか、順番が想定通りに行かないのか。`autoload`のせいで想定通りの順番になっていない？
- 読書など:
    - [型システム入門 プログラミング言語と型の理論](https://www.ohmsha.co.jp/book/9784274069116/)
        - 2025/08/18 - 2025/09/21

[先週の記録はこちら](https://github.com/igrep/daily-commits/blob/62d4627e7315a083fcd642aac8434b253cd3974f/yesterday.md)
